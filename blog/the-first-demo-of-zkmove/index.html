<!DOCTYPE html>
<html lang="ja">

<head>

<meta charset="utf-8">
<title>zkMove | The First Demo of zkMove</title>
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<link rel="apple-touch-icon" sizes="180x180" href='/apple-touch-icon.png'>
<link rel="icon" type="image/png" sizes="32x32" href='/favicon-32x32.png'>
<link rel="icon" type="image/png" sizes="16x16" href='/favicon-16x16.png'>
<link rel="manifest" href='/site.webmanifest'>

<link href='/css/fa6.min.css' rel="stylesheet" type="text/css">




<link rel="stylesheet" href="/css/style.min.4d2496cb7341bed47ddb76b8c2ed30111283acd5c87716cb237ec65f1fb73bed.css" />


<link href='/css/style.min.css' rel="stylesheet" type="text/css">
<link rel="stylesheet" href='/css/custom.css'>
<meta property="og:title" content="zkMove | The First Demo of zkMove" />




<meta name="description" content="The First Demo of zkMove">
<meta property="og:title" content=" | " />
<meta property="og:site_name" content="zkMove">
<meta property="og:description" content="The First Demo of zkMove">
<meta property="og:url" content="https://tella.suoyuan.xyz/blog/the-first-demo-of-zkmove/">
<meta property="og:type" content="article">
<meta property="og:locale" content="ja_JP">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@tech_chiba">

<link rel="canonical" href="https://tella.suoyuan.xyz/blog/the-first-demo-of-zkmove/">

<meta name="twitter:description" content="The First Demo of zkMove">
<meta property="article:published_time" content="2022-07-01T00:00:00&#43;00:00">
<meta property="article:updated_time" content="2022-07-01T00:00:00&#43;00:00">





    
<meta property="og:image" content="https://tella.suoyuan.xyz/img/blog/blog2.webp">
<meta property="og:image:url" content="https://tella.suoyuan.xyz/img/blog/blog2.webp">
    

<meta name="twitter:title" content="The First Demo of zkMove">
<link rel="preload" href='/css/sweetalert2.min.css' as="style"
    onload="this.onload=null;this.rel='stylesheet'">

</head>

<body class="flex flex-col min-h-screen">
  <main class="flex-grow"><header>
    <div id="overlay">
        <ul class="text-center list-none text-white text-3xl">
            
            <li class="p-2">
                <a href="/">
                    <span>Home</span>
                </a>
            </li>
            
            <li class="p-2">
                <a href="/blog/">
                    <span>Tech Blog</span>
                </a>
            </li>
            
            <li class="p-2">
                <a href="/about/">
                    <span>About Us</span>
                </a>
            </li>
            
            <li class="p-2">
                <a href="/joinus/">
                    <span>Careers</span>
                </a>
            </li>
            
        </ul>
    </div>
    <nav class="flex items-center justify-between flex-wrap bg-opacity-100 p-8">
        <div class="flex items-center flex-shrink-0 text-xl text-grey-900 mr-6">
            <a href="https://tella.suoyuan.xyz/"><img alt="zkMove Logo"
                    class="h-14 mr-3" src="/img/logo/logo.jpg"></a>
        </div>
        <div class="block lg:hidden">
            <div id="hamburgerbtn" class="flex cursor-pointer items-center w-14 h-10 py-2 rounded mopen">
                <span class="top"></span>
                <span class="middle"></span>
                <span class="bottom"></span>
            </div>
        </div>
        <div class="hidden w-full block flex-grow lg:flex lg:items-center lg:w-auto" id="mobileMenu">
            <div class="text-lg lg:flex-grow">
            </div>
            <div class="text-lg">
                
                <a href="/"
                    class="duration-200 block mt-4 lg:inline-block lg:mt-0 text-black hover:opacity-60 mr-8">
                    Home
                </a>
                
                <a href="/blog/"
                    class="duration-200 block mt-4 lg:inline-block lg:mt-0 text-black hover:opacity-60 mr-8">
                    Tech Blog
                </a>
                
                <a href="/about/"
                    class="duration-200 block mt-4 lg:inline-block lg:mt-0 text-black hover:opacity-60 mr-8">
                    About Us
                </a>
                
                <a href="/joinus/"
                    class="duration-200 block mt-4 lg:inline-block lg:mt-0 text-black hover:opacity-60 mr-8">
                    Careers
                </a>
                
            </div>
        </div>
    </nav>
</header><div class="scroll-top rounded-full">
      <span class="icon-keyboard_arrow_up text-2xl"></span>
    </div>
<div class="mx-auto my-10 max-w-6xl">
    <div class="mx-3 col-span-3 lg:col-span-2 px-2">
        <h1 class="title text-5xl font-bold mb-3">The First Demo of zkMove</h1>
        <section class="mb-4 text-lg">
            <h4 id="date" class="flex flex-row items-center"><span class="icon-access_time text-2xl mr-2"></span>
                2022/07/01 </h4>
            
            <h4 class="flex flex-row items-center"><span class="icon-person text-2xl mr-2"></span>zkMove
            </h4>
            
            
        </section>
        
        <img class="my-4" src="https://tella.suoyuan.xyz/img/blog/blog2.webp">
        
        <div class="content prose md:prose-lg lg:prose-xl max-w-none py-1"><p>Last week, I gave a demo at the Move community’s weekly meeting. It was the first public appearance of zkMove. We had a comprehensive discussion about the features of zkMove, which I will summarize briefly here with this post.</p>
<h2 id="the-first-demo-of-zkmove">The First Demo of zkMove</h2>
<blockquote>
<p>Hello, everyone! This is Guangyu Zhu, the author of zkMove. Last week, I gave a demo at the Move community&rsquo;s weekly meeting. It was the first public appearance of zkMove. We had an active discussion about the features of zkMove, which I will summarize briefly here with this post.</p>
</blockquote>
<h3 id="whats-zkmove">What‘s zkMove?</h3>
<p>zkMove is a zk-proof friendly Move language runtime environment. The initial idea of zkMove is to improve the programmability and composability of zk-proof with Move language. Developers can build scaling and privacy solution based on it. Below is some highlights of zkMove.</p>
<ul>
<li>
<p><strong>A zero-knowledge proof-friendly Move bytecode virtual machine</strong>. As a new generation of programming language for digital assets, Move ensures security of assets at the language level. Further more, zkMove is compatible with the community Move VM at bytecode level. This makes it possible to use it as a proof of validity for the transaction blocks at layer1.</p>
</li>
<li>
<p><strong>Powered by Halo2</strong>.  Halo2 uses Plonkish arithmetization, which support custom gate and lookup argument, is suitable for constructing complicated circuit. No trusted setup required</p>
</li>
<li>
<p><strong>No compromise on performance while pursuing Turing completeness</strong>. Two types of circuits are combined: VM circuits to handle conditional branches and loops, and Move circuits, which directly compiled from bytecodes, offer smaller proof size and shorter proving time.</p>
</li>
</ul>
<h3 id="high-level-architecture">High-level Architecture</h3>
<p>To better understand the demo, let&rsquo;s take a look at the high-level architecture of zkMove. Before we execute a transaction, it is assumed that the smart contract should have already been published on zkMove. The proving key and verification key are generated at the time of publishing.</p>
<p><img src="/img/blog/zkmove-arch.png" alt="zkmove-arch"></p>
<p>On zkMove, a transaction takes three steps to complete execution. The first step is to execute the transaction and generate a witness. The witness includes the transaction itself, the root of the old state tree, the accounts involved in the transaction and the associated Merkle proof. Furthermore, the witness includes the execution trace of the transaction.</p>
<p>In the second step, a universal or a smart contract specific circuit is selected depending on the configuration. The root of the new state tree is passed to the circuit as the public input. Then, the witness, the public input, and the circuit are sent to the prover to generate zk proof for the transaction.</p>
<p>Finally the zk proof and the public input will be sent to the verifier, a smart contract on the chain, to verify the zk proof. If it passes, the new state root will be recorded on the chain.</p>
<h3 id="vm-circuit-vs-move-circuit">VM circuit vs. Move circuit</h3>
<p>As I mentioned above, one of highlights of zkMove is the performance. VM circuit provides Turing completeness, while Move circuit provides smaller proof size and shorter proving time.</p>
<p>Inspired by Tinyram and zkEVMs, we construct VM circuit to verify the consistency and integrity of each step in execution trace. It can be broken down into tree parts:</p>
<ul>
<li>The right bytecode is loaded.</li>
<li>Each bytecode was executed properly.</li>
<li>Each load from locals, stack and global state retrieves the last value stored there.</li>
</ul>
<p>Halo2&rsquo;s plonkish arithmetization provides custom gates and lookup arguments. When a circuit encounters some expensive operations, it can outsource the work to other circuits by lookup. This makes it possible to construct a complex circuit to verify the execution trace of the Move VM.</p>
<p>The VM circuit is assembled from multiple sub-circuits, including the execution circuit, the bytecode circuit, and the memory circuit. To verify that the right bytecode is executed, we look up the bytecode table in the execution circuit and use the bytecode circuit to constrain the bytecode table is the same as the smart contract. To verify memory coherence, we look up the read/write table in the execution circuit and use the memory circuit to constrain each load from locals or stack retrieves the last value stored there. This is VM circuit.</p>
<p>Unlike the VM circuit, Move circuits are smart contract specific circuits. The bytecode of the smart contract is &ldquo;compiled&rdquo; directly into the circuit. Constraints are automatically applied by the virtual machine.</p>
<p><img src="/img/blog/move-circuit.png" alt="move-circuit"></p>
<p>To handle conditional branching, ProgramBlock was introduced to express the control flow. However, loop statements are not supported at the moment. So Move circuits are Turing incomplete and are suitable for simple transactions such as token transfers.</p>
<h3 id="demo-and-performance">Demo and Performance</h3>
<p>The implementation of the circuits is a bit complicated, we will introduce them in a separate document, now is the demo time!</p>
<p>We have a <a href="https://github.com/young-rocks/zkmove/tree/master/demo">CLI</a> and some examples to demonstrate the functionality of the zkMove virtual machine. Below command will first compile <em>add.move</em> into bytecode, execute the bytecode to generate an execution trace, then build the circuit and setup the proving/verification key, and then generate a zkp for the execution with the proving key and finally verify the proof with the verification key.</p>
<pre tabindex="0"><code>bin/zkmove run -s examples/scripts/add.move
</code></pre><p>The Move program consists of scripts and modules. For testing, directive &lsquo;mods&rsquo; can be added to script source file to import a module. Also, we can pass arguments to a script with directive &lsquo;args&rsquo;. For example,</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#e6db74">/// call_u8.move
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"></span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">//! mods: arith.move
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">//! args: 1u8, 2u8
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"></span>script {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">use</span> <span style="color:#ae81ff">0x1</span>::M;
</span></span><span style="display:flex;"><span>    fun main(x: <span style="color:#66d9ef">u8</span>, y: <span style="color:#66d9ef">u8</span>) {
</span></span><span style="display:flex;"><span>        M::add_u8(x, y);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>And we need tell vm where to load the module with option &lsquo;-m&rsquo;:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>bin/zkmove run -s examples/scripts/call_u8.move -m examples/modules/
</span></span></code></pre></div><p>zkMove supports two types of circuits: the vm circuit and the move circuit. By default the vm circuit is used, which is Turing complete but slow. Move circuit is faster than vm circuit, but it&rsquo;s not Turing-complete. We can enable the move circuit via the command option &ldquo;&ndash;fast-mode&rdquo;.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>bin/zkmove run -s examples/scripts/add.move --fast-mode
</span></span></code></pre></div><p>Below is some prelimiary performance data collected on MacOS Catalina with 2 GHz Quad-core Intel Core i5 and 16 GB RAM. We can see Move circuit is ~100 times faster than vm circuit.</p>
<p><img src="/img/blog/data.png" alt="data"></p>
<p><strong>Note</strong> - zkMove is still under heavy development, there is lots of limitations and issues. After we support global state, the gap between the Move circuit and the VM circuit should be much larger than 100 times. Also, we don&rsquo;t recommend you do performance comparisons with other zk VMs as that can be misleading. I will update the data in time once we complete the missing features.</p>
<h3 id="limitations-and-issues">Limitations and issues</h3>
<p>The project is still in an early stage. There are many limitations and issues in the virtual machine. For example, there is a lack of support for global state and only simple data types are supported. Moreover, the performance of both the circuit and the underlying proof system needs further improvement. Once these issues are well taken care of, we will make the source code available. Stay tuned!</p></div>
        <div class="share m-2 grid grid-cols-2 lg:grid-cols-3 gap-2">
            <a href="https://twitter.com/intent/tweet?url=https%3a%2f%2ftella.suoyuan.xyz%2fblog%2fthe-first-demo-of-zkmove%2f&text=The%20First%20Demo%20of%20zkMove" target="_blank"
                title="Tweet" class="share-button twitter">
                <div class="text-white text-center">
                    <span class="icon-twitter text-lg mr-2"></span>Twitter
                </div>
            </a>
            <a href="javascript:OnClickURL();" class="share-button url" title="Copy to Clipboard"
                data-clipboard-text="The First Demo of zkMove https://tella.suoyuan.xyz/blog/the-first-demo-of-zkmove/" id="url">
                <div class="text-white text-center">
                    <span class="icon-link text-lg mr-2"></span>Copy
                </div>
            </a>
        </div>
        <hr class="py-4">
        <aside id="meta">
            <div class="grid grid-cols-2">
                <div class="col-span-1">
                    
                    <a class="previous lg:text-2xl" href="https://tella.suoyuan.xyz/blog/zkmove-at-a-glance/">
                        <div
                            class="transition-colors duration-300 border border-gray-600 hover:border-black h-auto m-3 text-center py-3 lg:py-1">
                            <span class="icon-keyboard_arrow_left"></span> zkMove at a Glance
                        </div>
                    </a>
                    
                </div>
                
                <a class="next lg:text-2xl" href="https://tella.suoyuan.xyz/blog/seven-questions-about-zkmove/">
                    <div
                        class="transition-colors duration-300 col-span-1 border border-gray-600 hover:border-black h-auto m-3 text-center py-3 lg:py-1">
                        Seven Questions About zkMove <span class="icon-keyboard_arrow_right"></span>
                    </div>
                </a>
                
            </div>
        </aside>
    </div>
</div>

  </main><footer class="bg-tlgray-100">
  
  <script src='/js/clipboard.min.js'></script>
  <script src='/js/highlight.min.js'></script>
  <script src='/js/highlightjs-line-numbers.min.js'></script>
  <script src='/js/sweetalert2.min.js'></script>
  <script>
    hljs.initHighlightingOnLoad();
    hljs.initLineNumbersOnLoad();
    new ClipboardJS('.url');

    function OnClickURL() {
      Swal.fire({
        icon: 'success',
        title: 'Copied!',
        text: 'Copied the URL and title.'
      })
    }
  </script>
  
  <script>
    function toggleNav() {
      var hamburger = document.getElementById("hamburgerbtn");
      var overlay = document.getElementById("overlay");
      var body = document.body;

      hamburger.addEventListener("click", function () {
        overlay.classList.toggle("open");
        hamburger.classList.toggle("is-open");
        body.classList.toggle("scroll-lock");
      });
    }
    toggleNav();

    document.querySelector('.scroll-top').addEventListener('click', () => {
      document.documentElement.scrollTop = 0;
    });
  </script>
  
  <link href="https://fonts.googleapis.com/css2?family=Montserrat&family=Open+Sans&display=swap" rel="stylesheet" />
  
  <div class="flex items-center justify-between flex-wrap bg-gray-800 p-8 text-white">
    <div class="copy pl-8 py-5 bg-tlgray-900 text-white text-md">
      &copy; zkMove Ltd 2023 .
    </div>
    <div class="w-full block flex-grow lg:flex lg:items-center lg:w-auto" id="mobileMenu">
      <div class="text-lg lg:flex-grow">
      </div>
      <div class="flex flex-row items-center text-lg">
        
        <a href="https://twitter.com/zkmove" class="block mt-4 lg:inline-block lg:mt-0 text-gray-300 hover:text-white mr-8">
          
          <i class='icon-twitter text-2xl'></i>
          
        </a>
        
        <a href="https://github.com/young-rocks" class="block mt-4 lg:inline-block lg:mt-0 text-gray-300 hover:text-white mr-8">
          
          <i class='icon-github text-2xl'></i>
          
        </a>
        
        <a href="https://discord.gg/d6yMS2yycq" class="block mt-4 lg:inline-block lg:mt-0 text-gray-300 hover:text-white mr-8">
          
          <i class='icon-discord text-2xl'></i>
          
        </a>
        
      </div>
    </div>
    <div></div>
  </div>
</footer>
</body>

</html>